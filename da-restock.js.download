"use strict";function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var classCallCheck=createCommonjsModule(function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports}),_classCallCheck=unwrapExports(classCallCheck),createClass=createCommonjsModule(function(e){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}),_createClass=unwrapExports(createClass),emailIsValid=function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)};function _createForOfIteratorHelper$1(e,t){var o,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$1(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw n}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(o="Object"===o&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var getUrlParameterByName=function(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},shouldExcludeRelatedProductsSection=function(e){return!!(e.closest(".related-products-product-template")||e.closest(".recommended-products-section")||e.closest(".shopify-section-template--product--recommendations")||e.closest("#ga-product_related")||e.closest("#ga-product_bought_together")||e.closest(".product-recommendations"))},shouldExcludeUpsellSection=function(e){return!!e.closest("#nudge-offer")},Product=function(){function t(e){_classCallCheck(this,t),this.shop=e}return _createClass(t,[{key:"initDaRestock",value:function(){var e=Array.from(document.querySelectorAll(".da-restock-alwaysShow")).filter(function(e){return!shouldExcludeRelatedProductsSection(e)});document.querySelector(".da-restock-notification")&&!e.length&&(this.initChangeHandler(),this.changeHandler()),this.initForm(),this.handleUrlParamResponse()}},{key:"initChangeHandler",value:function(){var t=this;document.querySelectorAll("select").forEach(function(e){e.addEventListener("change",function(e){setTimeout(t.changeHandler,500)})}),document.querySelectorAll("input[type=radio]").forEach(function(e){e.addEventListener("change",function(e){setTimeout(t.changeHandler,500)})}),document.addEventListener("click",function(e){setTimeout(t.changeHandler,500)}),document.querySelectorAll("button").forEach(function(e){e.addEventListener("click",function(e){setTimeout(t.changeHandler,500)})}),document.querySelectorAll("a").forEach(function(e){e.addEventListener("click",function(e){setTimeout(t.changeHandler,500)})})}},{key:"changeHandler",value:function(){var e,t,o,r,n,a=null;"inline-block"!==document.querySelector("#dd-restock-notification-msg-success").style.display&&(n=null!==document.querySelector("select[name=id] option:disabled"),e=document.querySelector("select[name=id] option:checked"),o=(t=document.querySelector("input[name=id]"))&&document.querySelector("#da-restock-notification-variant-"+t.value),r=getUrlParameterByName("variant"),n||!e||!e.value||shouldExcludeRelatedProductsSection(e)||shouldExcludeUpsellSection(e)?r?(a=r,console.log("b",a)):o&&!shouldExcludeRelatedProductsSection(t)?(a=t.value,console.log("c",a)):"undefined"!=typeof da_variant&&(a=da_variant,console.log("d",a)):(a=e.value,console.log("a",a)),a&&document.querySelectorAll(".da-restock-notification").forEach(function(e){e.style.display="none"}),n="#da-restock-notification-variant-"+a,document.querySelector(n)&&(document.querySelector(n).style.display="block"))}},{key:"initForm",value:function(){var t=this,e=document.querySelector(".da-restock-alwaysShow");e&&(e.style.display="block"),document.querySelectorAll("div.da-restock-notification form, .da-restock-image form.da-restock-form").forEach(function(e){e.action=""}),document.querySelectorAll("div.da-restock-notification form, .da-restock-image form.da-restock-form").forEach(function(e){e.addEventListener("submit",function(e){e.preventDefault()})}),document.querySelectorAll("div.da-price-notification-form input[name=email]").forEach(function(e){e.addEventListener("change",function(){document.querySelectorAll("#dd-price-notification-msg, #dd-price-notification-msg-error").forEach(function(e){e.style.display="none"})})}),document.querySelectorAll("div.da-restock-notification form").forEach(function(e){e.addEventListener("submit",function(e){return t.legacyCreateFormHandler(e,t.shop)})}),document.querySelectorAll("div.da-restock-notification-form .da-restock-notification-button").forEach(function(e){e.addEventListener("click",function(e){return t.createFormHandler(e,t.shop)})}),document.querySelectorAll("div.da-restock-notification-form input[name=email]").forEach(function(n){n.addEventListener("keypress",function(e){if(13===e.keyCode){var t,o=_createForOfIteratorHelper$1(n.parentNode.children);try{for(o.s();!(t=o.n()).done;){var r=t.value;r.classList.contains("da-restock-notification-button")&&r.click()}}catch(e){o.e(e)}finally{o.f()}}})})}},{key:"legacyCreateFormHandler",value:function(e,t){e.preventDefault(),e.stopPropagation();var e=e.target||e.srcElement,o=e.querySelector("[type=submit]");o&&o.removeEventListener("submit",this.createFormHandler),e.removeAttribute("onSubmit"),this.combinedFormHandler(e,t)}},{key:"createFormHandler",value:function(e,t){e.preventDefault(),e.stopPropagation();var e=e.target||e.srcElement,o=e.closest(".da-restock-notification-form");e&&e.removeEventListener("click",this.createFormHandler),this.combinedFormHandler(o,t)}},{key:"combinedFormHandler",value:function(t,e){var o=t.querySelector("input[name=email]").value,r=t.closest("#dd-restock-notification-container"),n=(r||document).querySelector("#dd-restock-notification-msg");o&&emailIsValid(o)?(n.querySelector("#dd-restock-notification-msg-success, #dd-restock-notification-msg-error").display="none",r={email:t.querySelector("input[name=email]")?t.querySelector("input[name=email]").value:"",store:e,product:t.querySelector("input[name=product]")?t.querySelector("input[name=product]").value:"",url:t.querySelector("input[name=url]")?t.querySelector("input[name=url]").value:"",ajax:"true",firstName:t.querySelector("input[name=firstName]")?t.querySelector("input[name=firstName]").value:"",lastName:t.querySelector("input[name=lastName]")?t.querySelector("input[name=lastName]").value:"",daAcceptsMarketing:t.querySelector("input[name=daAcceptsMarketing]")?t.querySelector("input[name=daAcceptsMarketing]").value:""},t.querySelector("input[name=variant]")&&t.querySelector("input[name=variant]").value?r.variant=t.querySelector("input[name=variant]").value:t.querySelector("select[name=variant]")&&t.querySelector("select[name=variant]").value?r.variant=t.querySelector("select[name=variant]").value:t.querySelector("input[name=davariant]")&&t.querySelector("input[name=davariant]").value?r.variant=t.querySelector("input[name=davariant]").value:t.querySelector("select[name=davariant]")&&t.querySelector("select[name=davariant]").value&&(r.variant=t.querySelector("select[name=davariant]").value),window.fetch("https://alertmerestockalerts.herokuapp.com/addemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){if(!e.ok)throw Error(e.statusText);n.querySelector("#dd-restock-notification-msg-error").style.display="none",n.style.display="inline-block",n.querySelector("#dd-restock-notification-msg-success").style.display="inline-block",t.closest(".da-restock-notification").style.display="none"}).catch(function(e){n.style.display="inline-block",n.querySelector("#dd-restock-notification-msg-error").style.display="inline-block"})):(n.style.display="inline-block",n.querySelector("#dd-restock-notification-msg-error").style.display="inline-block")}},{key:"handleUrlParamResponse",value:function(){var e=getUrlParameterByName("restocknotify");"success"===e?(document.querySelector("#dd-restock-notification-msg").style.display="block",document.querySelector(".da-restock-notification").style.display="none",document.querySelector("#dd-restock-notification-msg-success")?(document.querySelector("#dd-restock-notification-msg-success").style.display="block",document.querySelector("#dd-restock-notification-msg-error").style.display="none"):document.querySelector("#dd-restock-notification-msg").appendChild(document.createTextNode("Thanks for signing up for restock notifications!"))):"error"===e&&(document.querySelector("#dd-restock-notification-msg").style.display="block",document.querySelector("#dd-restock-notification-msg-success").style.display="none",document.querySelector("#dd-restock-notification-msg-error").style.display="block")}}]),t}();function _createForOfIteratorHelper(e,t){var o,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(o="Object"===o&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var htmlToElement=function(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild},Collection=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"initDaRestock",value:function(){var t=this;document.querySelectorAll("img[data-da-restock-shop]").forEach(function(e){return t.addClassesToOutOfStockItems(e,"v1")}),document.querySelectorAll("[data-da-restock-shop-new]").forEach(function(e){return t.addClassesToOutOfStockItems(e,"v2")}),document.querySelectorAll("[data-da-restock-shop-v3]").forEach(function(e){return t.addClassesToOutOfStockItems(e,"v3")}),this.addFormToOutOfStockItems(),this.createWindowResizeHandler(),this.legacyAddFormToOutOfStockItems(),this.initForm(),this.detectDomChanges()}},{key:"detectDomChanges",value:function(){var n=this;new MutationObserver(function(e,t){var o,r=_createForOfIteratorHelper(e);try{for(r.s();!(o=r.n()).done;)"childList"===o.value.type&&(document.querySelectorAll("[data-da-restock-shop-new]").forEach(function(e){e.classList.contains("v2")||n.addClassesToOutOfStockItems(e,"v2")}),document.querySelectorAll("[data-da-restock-shop-v3]").forEach(function(e){e.classList.contains("v3")||n.addClassesToOutOfStockItems(e,"v3")}))}catch(e){r.e(e)}finally{r.f()}n.addFormToOutOfStockItems(),n.initForm()}).observe(document,{childList:!0,subtree:!0})}},{key:"addClassesToOutOfStockItems",value:function(e,t){var o="da-restock-collection-img",r="data-da-restock-shop";"v2"===t?(o="da-restock-collection-img-new",r="data-da-restock-shop-new"):"v3"===t&&(o="da-restock-collection-img-v3",r="data-da-restock-shop-v3"),e.classList.contains(o)||(e.classList.add(o),t=e.getAttribute("data-da-restock-product-id"),o=e.getAttribute(r),e.classList.add("da-restock-product-id-"+t),e.classList.add("da-restock-shop-"+o))}},{key:"getV2Form",value:function(e){var t=e.small,o=e.url,r=e.productText,n=e.inputText,a=e.buttonText,c=e.absolute,i=e.parentHeight,l=e.height,s=e.daShop,u=e.product;return e.aspectRatio,htmlToElement("<div class='da-restock-collection-img-new-wrapper' style='"+("width: 100%; position:"+(c?"absolute":"relative")+";bottom:"+(c?(l&&i&&0<i-l&&i-l<100?i-l:0)+"px":"auto"))+"'><form action='https://alertmerestockalerts.herokuapp.com/addemail' method='post' style='position: unset; width:100%' class='da-restock-form "+t+"'><p>"+r+"</p><input type=hidden name=url value='"+o+"'/><input type=text name=email placeholder='"+n+"'><input type=hidden name=store value='"+s+"'><input type=hidden name=product value='"+u+"'><button type=submit>"+a+"</button></form></div>")}},{key:"getV3Form",value:function(e){var t=e.small,o=e.url,r=e.productText,n=e.inputText,a=e.buttonText,c=e.absolute,i=e.parentHeight,l=e.height,s=e.daShop,u=e.product;return e.aspectRatio,htmlToElement("<div class='da-restock-collection-img-v3-wrapper' style='".concat("width: 100%; position:"+(c?"absolute":"relative")+";bottom:"+(c?(l&&i&&0<i-l&&i-l<100?i-l:0)+"px":"auto"),"'>\n        <div action='https://alertmerestockalerts.herokuapp.com/addemail' method='post' style='position: unset; width:100%' class='da-restock-form ").concat(t,"'>\n          <input type=hidden name=url value='").concat(o,"'/>\n          <input type=hidden name=store value='").concat(s,"'>\n          <input type=hidden name=product value='").concat(u,'\'>\n        <div class="da-container">\n          <div class="da-row">\n            <div class="da-col-12">\n               ').concat(r,'\n            </div>\n          </div>\n          <div class="da-row da-row-form-elements">\n            <div class="da-col-6">\n              <input type=text name=email placeholder=\'').concat(n,'\'>\n            </div>\n            <div class="da-col-6">\n              <button type=submit>').concat(a,"</button>\n            </div>\n          </div>\n        </div>\n        </div>\n        </div>"))}},{key:"addFormToOutOfStockItems",value:function(){var p=this;document.querySelectorAll(".da-restock-collection-img-new, .da-restock-collection-img-v3").forEach(function(e){var t,o,r,n,a,c,i,l,s=e.nextElementSibling,u="",d="",m=(e.classList.forEach(function(e){var t=e.split("da-restock-product-id-"),e=e.split("da-restock-shop-");t[1]?u=t[1]:e[1]&&(d=e[1])}),!u||!d);m&&console.log("Incorrect collection page installation of Alert Me Restock Alerts. Contact support at hi@dibbledevelopment.com"),m||s&&(s.classList.contains("da-restock-collection-img-new-wrapper")||s.classList.contains("da-restock-collection-img-v3-wrapper"))||(m=e.clientWidth,s=e.clientHeight,(120<=m||0===m)&&(i=m<200?" da-restock-form-small ":"",l=e.closest("a")?e.closest("a").getAttribute("href"):"",t=e.getAttribute("data-datext")||"Alert Me When Restocked!",o=e.getAttribute("data-dainput")||"Email",r=e.getAttribute("data-dabutton")||"Sign Up",n=e.getAttribute("data-daInline")?parseInt(e.getAttribute("data-daInline")):1,a=e.parentElement.outerHeight,c=e.getAttribute("data-aspectratio"),i={small:i,url:l,productText:t,inputText:o,buttonText:r,absolute:n,parentHeight:a,height:s=0===s&&c?m/c:s,daShop:d,product:u,aspectRatio:c},l=e.classList.contains("da-restock-collection-img-new")?p.getV2Form(i):p.getV3Form(i),e.parentElement.insertBefore(l,e.nextSibling)))})}},{key:"legacyAddFormToOutOfStockItems",value:function(){document.querySelectorAll("img.da-restock-collection-img").forEach(function(e){var t,o,r,n,a,c,i,l,s,u,d,m,p,f;e.closest(".da-restock-image")||(f=e.clientWidth,t=e.clientHeight,(120<=f||0===f)&&(e.classList.contains("da-restock-image-use-div-product-image")&&(f=e.closest(".product-image").clientWidth),(o=e.closest("a"))&&(o.style.width=f),r=f<200?" da-restock-form-small ":"",n=htmlToElement("<span class=da-restock-image></span>"),a=o?o.getAttribute("href"):"",i=c="",e.classList.forEach(function(e){var t=e.split("da-restock-product-id-"),e=e.split("da-restock-shop-");t[1]?c=t[1]:e[1]&&(i=e[1])}),d="",m=o?o.style["margin-left"]:"0px",p=o?o.style["margin-right"]:"0px","0px"===m&&"0px"===p&&(p=m="auto",d="left:0;right:0;"),l=e.getAttribute("data-datext")||"Alert Me When Restocked!",s=e.getAttribute("data-dainput")||"Email",u=e.getAttribute("data-dabutton")||"Sign Up",d=htmlToElement("<form action='https://alertmerestockalerts.herokuapp.com/addemail' method='post' style='"+d+"margin-left:"+m+";margin-right:"+p+";width:"+f+"px' class='da-restock-form "+r+"'><p>"+l+"</p><input type=hidden name=url value='"+a+"'/><input type=text name=email placeholder='"+s+"'><input type=hidden name=store value='"+i+"'><input type=hidden name=product value='"+c+"'><button type=submit>"+u+"</button></form>"),o&&(o.parentNode.insertBefore(n,o),n.appendChild(o)),(m=e.closest(".da-restock-image"))&&m.insertBefore(d,m.firstChild),0<(p=(o?o.outerHeight:0)-t)&&m&&(f=10+p,m.querySelector(".da-restock-form").style.bottom=f)))}),this.legacyCreateWindowResizeHandler()}},{key:"initForm",value:function(){var o=this.createFormHandler;document.querySelectorAll(".da-restock-collection-img-new-wrapper, .da-restock-collection-img-v3-wrapper, .da-restock-collection-img-v4-wrapper").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()})}),document.querySelectorAll(".da-restock-collection-img-new-wrapper button, .da-restock-collection-img-v3-wrapper button").forEach(function(o){o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var e=o.closest(".da-restock-form"),t=new Event("submit");e.dispatchEvent(t)})}),document.querySelectorAll(".da-restock-form").forEach(function(t){t.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),o(e,!0,t)})})}},{key:"createFormHandler",value:function(e,t,o){e.preventDefault(),e.stopPropagation();var r,e=t?o:o.closest(".da-restock-form"),t=e.querySelector("input[name=email]").value;t&&emailIsValid(t)&&(r=e.querySelector("input[name=product]")?e.querySelector("input[name=product]").value:"",o={email:t,store:e.querySelector("input[name=store]")?e.querySelector("input[name=store]").value:"",product:r,ajax:!0},fetch("https://alertmerestockalerts.herokuapp.com/addemail",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(function(e){if(!e.ok)throw Error(e.statusText);document.querySelectorAll(".da-restock-form").forEach(function(e){var t=e.querySelector("input[name=product]");r&&t&&t.value===r&&e.parentNode.removeChild(e)})}).catch(function(e){console.error("ERROR",e)}))}},{key:"createWindowResizeHandler",value:function(e){window.addEventListener("resize",function(e){document.querySelectorAll(".da-restock-collection-img-new").forEach(function(e){var t=e.clientWidth,e=e.parentNode.querySelector(".da-restock-collection-img-new-wrapper .da-restock-form");e&&(e.style.width=t||"100%")})})}},{key:"legacyCreateWindowResizeHandler",value:function(e){window.addEventListener("resize",function(){document.querySelectorAll("img.da-restock-collection-img").forEach(function(e){var t=e.clientWidth,e=e.closest("a"),o=e?e.style["margin-left"]:"0px",r=e?e.style["margin-right"]:"0px",e=("0px"===o&&"0px"===r&&(r=o="auto",style="left:0;right:0;"),e.style.width=t+"px",e.parentNode.querySelector(".da-restock-form"));e&&(e.style.width=t+"px",e.style["margin-left"]=o,e.style["margin-right"]=r)})})}}]),e}(),Scripts=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getShop",value:function(){var e=document.currentScript,t=(e||(e=(t=document.getElementsByTagName("script"))[t.length-1]),new RegExp("[?&]shop=([^&#]*)").exec(e.getAttribute("src")));if(t&&t[1])return t[1];e=document.querySelector("#dd-restock-notification-container form input[name=store]");if(e&&e.value)return e.value;t=document.querySelector(".da-restock-form input[name=store]");return t&&t.value?t.value:""}},{key:"appendCssFiles",value:function(e){var t=document.createElement("link"),o=(t.rel="stylesheet",t.href="https://s3-us-west-2.amazonaws.com/da-restock/da-restock.css",t.type="text/css",document.createElement("link"));o.rel="stylesheet",o.href="https://s3-us-west-2.amazonaws.com/da-restock/da-restock-"+e+".css",o.type="text/css",document.head.appendChild(t),document.head.appendChild(o)}}]),e}(),scripts=new Scripts,dashop=scripts.getShop(),daRestockProductForm=(scripts.appendCssFiles(dashop),new Product(dashop)),daRestockCollectionForm=new Collection(dashop);daRestockProductForm.initDaRestock(),daRestockCollectionForm.initDaRestock();
