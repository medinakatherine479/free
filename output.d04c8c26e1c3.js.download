function get_param(key,query_string){var query_data=query_string.substring(1).split('&'),i,t,k,v;for(i=0;i<query_data.length;i+=1){t=query_data[i].split('=');k=t[0];v=t[1]||'';if(k===key){return decodeURIComponent(v);}}
return'';}
window.sloyalty.origin=get_param('origin',window.location.search);window.sloyalty.xdstyle=get_param('xdstyle',window.location.search)||'0';window.sloyalty.minimized=get_param('minimized',window.location.search);;(function(angular){'use strict';var app=angular.module('app',['ngRoute','xdPreview']);app.config(['$interpolateProvider',function($interpolateProvider){$interpolateProvider.startSymbol('{$');$interpolateProvider.endSymbol('$}');}]);app.config(['xdPreviewProvider',function(xdPreviewProvider){var CONTEXT=window.sloyalty;xdPreviewProvider.set_component('widget');xdPreviewProvider.set_origin(CONTEXT.origin);if(CONTEXT.xdstyle==='1'){xdPreviewProvider.enable();}}]);app.controller('MaximizedWidgetCtrl',['$rootScope','$scope','$timeout','$window',function($rootScope,$scope,$timeout,$window){var CONTEXT=$window.sloyalty;$scope.description=CONTEXT.description;$scope.show_top_box=false;$scope.show_minimize_btn=function(){$scope.show_top_box=true;$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:widget:stylechange',data:{css:{height:'52px'}}}),decodeURIComponent(CONTEXT.origin));};$scope.hide_minimize_btn=function(){$scope.show_top_box=false;$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:widget:stylechange',data:{css:{height:'40px'}}}),decodeURIComponent(CONTEXT.origin));};$timeout(function(){var widget_box=document.querySelector('.widget-box-main');$rootScope.$emit('maximized-widget-loaded',widget_box.clientWidth+6);});}]);app.controller('WidgetCtrl',['$rootScope','$scope','$window',function($rootScope,$scope,$window){var CONTEXT=window.sloyalty,widget_minmax;$scope.show_rewards_overlay=function(){if(CONTEXT.enrolling==='1'){$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:account',data:{source:'tab-widget'}}),decodeURIComponent(CONTEXT.origin));}else{$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:rewards',data:{source:'tab-widget'}}),decodeURIComponent(CONTEXT.origin));}};widget_minmax=function(minimized,width){$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:widget:minmax',data:{minimized:minimized}}),decodeURIComponent(CONTEXT.origin));$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:widget:stylechange',data:{css:{width:width+'px',height:(minimized==='1')?'32px':'40px'}}}),decodeURIComponent(CONTEXT.origin));};$scope.maximize_widget=function($event){var del=$rootScope.$on('maximized-widget-loaded',function(event,width){widget_minmax('0',width);del();});};$scope.minimize_widget=function($event){widget_minmax('1',85);};}]);app.run(['$rootScope','$timeout','$location','$window',function($rootScope,$timeout,$location,$window){var
initialized=false,CONTEXT=window.sloyalty;function initialize_iframe_style(){var
widget_box=document.querySelector('.widget-box-main'),width=widget_box.clientWidth+6,height=widget_box.clientHeight+3,css={width:width+'px',height:height+'px'};if(CONTEXT.position==='bottom-left'){css.bottom='0px';css.left='20px';}else if(CONTEXT.position==='bottom-right'){css.bottom='0px';css.right='20px';}else if(CONTEXT.position==='bottom-center'){css.bottom='0px';css.left='50%';css.marginLeft=-width/2+'px';}
$.postMessage('SLOYALTY-'+JSON.stringify({module:'loyalty-v2',event:'loyalty:widget:ready',data:{css:css,widget_version:'4'}}),decodeURIComponent(CONTEXT.origin));initialized=true;};$rootScope.$on('$viewContentLoaded',function(){if(initialized){return;}
if(CONTEXT.minimized==='1'){$location.path('/minimized');}else{$location.path('/maximized');}
$timeout(initialize_iframe_style);});}]);app.config(['$routeProvider',function($routeProvider){var CONTEXT=window.sloyalty;$routeProvider.when('/maximized',{controller:'MaximizedWidgetCtrl',templateUrl:'widget.html'}).when('/minimized',{templateUrl:'minimized_widget.html'}).otherwise({redirectTo:(CONTEXT.minimized==='1')?'/minimized':'/maximized'});}]);angular.bootstrap(document,['app']);}(angular));;